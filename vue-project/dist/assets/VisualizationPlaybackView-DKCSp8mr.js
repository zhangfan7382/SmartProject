import{d as Q,r as l,e as X,u as Y,f as Z,g as ee,c as d,a as t,j as m,w as E,v as te,h as V,t as i,F as $,b as U,i as I,p as oe,m as M,o as u,_ as se}from"./index-Cm9KO5RD.js";const ae={class:"visualization-playback"},le={class:"video-replay-section card"},ne={class:"struct-data-section card"},ie=["disabled"],re={key:0,class:"status-tip"},ce={class:"content"},de={class:"main-view"},ue={class:"video-section card"},ve={class:"video-container"},pe=["src"],me={key:0,class:"empty-tip"},_e={class:"empty-content"},fe={class:"empty-actions"},be={class:"sample-videos"},ge=["onClick"],ye={class:"control-panel card"},he={class:"playback-controls"},ke=["title"],we={class:"speed-controls"},Se={class:"speed-label"},xe={class:"speed-label"},Ce={class:"recording-controls"},De={key:0,class:"recording-info"},Ee={class:"recording-time"},Ve={class:"recording-size"},Le={class:"log-section"},Te={class:"log-content"},Pe={class:"log-time"},Re={class:"log-message"},$e=Q({__name:"VisualizationPlaybackView",setup(Ue){l("full"),l("perception"),l(["perception","roadmodel","prediction","planning","control","obsl","activesafety"]),l(null),l(null),l("");const _=l(""),z=()=>{_.value&&(f.value=_.value,a.value&&(a.value.load(),a.value.play().catch(o=>{console.error("播放视频失败:",o)})))},L=l(null),g=l(""),j=o=>{const e=o.target.files;e&&e.length&&(L.value=e[0])},B=()=>{g.value="结构化数据播包已启动（可对接播包API）"},a=l(null),r=l(!1),y=l("1"),f=l("http://vjs.zencdn.net/v/oceans.mp4"),F=[{name:"TED演讲：自动驾驶中的AI挑战",url:"https://embed.ted.com/talks/jaerock_kwon_artificial_intelligence_challenges_in_connected_autonomous_vehicles",description:"探讨自动驾驶汽车中的人工智能挑战和解决方案"},{name:"TED演讲：自动驾驶技术",url:"https://embed.ted.com/talks/waymo_ceo_john_krafcik_the_road_to_a_self_driving_future",description:"Waymo CEO 分享自动驾驶技术的未来展望"},{name:"TED演讲：机器学习入门",url:"https://embed.ted.com/talks/kevin_slavin_how_algorithms_shape_our_world",description:"算法如何塑造我们的世界"},{name:"TED演讲：数据可视化",url:"https://embed.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen",description:"数据可视化的艺术与科学"},{name:"TED演讲：编程思维",url:"https://embed.ted.com/talks/linda_liukas_a_delightful_way_to_teach_kids_about_computers",description:"用有趣的方式教孩子编程"}],h=o=>{console.error("视频播放错误:",o);const e=o.target;console.log("错误详情:",{error:e.error,networkState:e.networkState,readyState:e.readyState})},N=o=>{f.value=o.url,a.value&&(a.value.load(),a.value.play().catch(e=>{console.error("播放视频失败:",e)}))};l("single");const k=l("1"),c=l(!1),w=l(0),T=l("0 MB"),b=l(null),O=X(()=>{if(!c.value)return"00:00:00";const o=Date.now()-w.value,e=Math.floor(o/36e5),s=Math.floor(o%36e5/6e4),n=Math.floor(o%6e4/1e3);return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}),A=()=>{c.value=!c.value,c.value?(w.value=Date.now(),b.value=window.setInterval(()=>{const o=Math.floor((Date.now()-w.value)/1e3);T.value=`${(o/1024).toFixed(2)} MB`},1e3)):b.value&&(clearInterval(b.value),b.value=null)},S=l([]),x=(o,e)=>{const s=new Date;S.value.push({time:s.toLocaleTimeString(),type:o,message:e})},W=()=>{const o=S.value.map(v=>`[${v.time}] ${v.type}: ${v.message}`).join(`
`),e=new Blob([o],{type:"text/plain"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=`test-log-${new Date().toISOString()}.txt`,n.click(),URL.revokeObjectURL(s)};Y([y,k],([o,e])=>{a.value&&(a.value.playbackRate=parseFloat(o)/parseFloat(e))});const C=()=>{r.value=!0,console.log("视频开始播放")},D=()=>{r.value=!1,console.log("视频暂停播放")};l([{id:"camera",name:"摄像头视图",visible:!0},{id:"lidar",name:"激光雷达点云",visible:!0},{id:"radar",name:"毫米波雷达",visible:!0},{id:"gps",name:"GPS轨迹",visible:!0},{id:"imu",name:"IMU数据",visible:!0}]);const H=()=>{a.value&&(r.value?a.value.pause():a.value.play(),r.value=!r.value)},G=()=>{a.value&&(a.value.currentTime+=1)},q=()=>{a.value&&(a.value.currentTime-=1)},J=()=>{if(a.value)try{const o=document.createElement("canvas"),e=a.value;o.width=e.videoWidth||e.clientWidth,o.height=e.videoHeight||e.clientHeight;const s=o.getContext("2d");if(!s){console.error("无法获取 canvas 上下文");return}s.drawImage(e,0,0,o.width,o.height);const n=new Date().toLocaleString();s.font="16px Arial",s.fillStyle="rgba(255, 255, 255, 0.8)",s.fillText(n,10,30);const v=`帧率: ${P.value.fps}fps | 延迟: ${P.value.latency}ms`;s.fillText(v,10,50);const K=o.toDataURL("image/png"),p=document.createElement("a"),R=`screenshot-${new Date().toISOString().replace(/[:.]/g,"-")}.png`;p.href=K,p.download=R,document.body.appendChild(p),p.click(),document.body.removeChild(p),x("info",`已保存截图: ${R}`)}catch(o){console.error("截图失败:",o),x("error","截图失败: "+(o.message||"未知错误"))}else x("error","视频播放器未初始化")};l({fps:30,latency:16});const P=l({fps:30,latency:16});return Z(()=>{a.value&&(a.value.addEventListener("play",C),a.value.addEventListener("pause",D),a.value.addEventListener("error",h),a.value.play().catch(o=>{console.error("自动播放失败:",o)}))}),ee(()=>{a.value&&(a.value.removeEventListener("play",C),a.value.removeEventListener("pause",D),a.value.removeEventListener("error",h))}),(o,e)=>(u(),d("div",ae,[e[16]||(e[16]=t("h1",null,"可视化工具与播包观测",-1)),t("div",le,[e[4]||(e[4]=t("h2",null,"视频流回放（云端）",-1)),t("label",null,[e[3]||(e[3]=m("云端视频流路径：")),E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),placeholder:"如：oss://bucket/video.mp4",class:"input-path"},null,512),[[te,_.value]])]),t("button",{class:"btn",onClick:z},"云端回放")]),t("div",ne,[e[6]||(e[6]=t("h2",null,"结构化数据播包",-1)),t("label",null,[e[5]||(e[5]=m("上传整车/传感器数据包：")),t("input",{type:"file",onChange:j},null,32)]),t("button",{class:"btn",disabled:!L.value,onClick:B},"开始播包",8,ie),g.value?(u(),d("div",re,i(g.value),1)):V("",!0)]),t("div",ce,[t("div",de,[t("div",ue,[t("div",ve,[t("video",{ref_key:"videoPlayer",ref:a,class:"video-player",controls:"",autoplay:"",crossorigin:"anonymous",onPlay:C,onPause:D,onError:h},[t("source",{src:f.value,type:"video/mp4"},null,8,pe),e[7]||(e[7]=m(" 您的浏览器不支持视频播放。 "))],544),f.value?V("",!0):(u(),d("div",me,[t("div",_e,[e[8]||(e[8]=t("div",{class:"empty-icon"},"🎥",-1)),e[9]||(e[9]=t("div",{class:"empty-text"},"暂无视频数据",-1)),e[10]||(e[10]=t("div",{class:"empty-desc"},"请选择或上传数据包，或选择示例视频",-1)),t("div",fe,[t("div",be,[(u(),d($,null,U(F,s=>t("button",{key:s.name,class:"btn btn-small sample-btn",onClick:n=>N(s)},i(s.name),9,ge)),64))])])])]))])])]),t("div",ye,[t("div",he,[t("button",{class:"btn control-btn",onClick:q,title:"后退一帧"},"⏪"),t("button",{class:"btn control-btn",onClick:H,title:r.value?"暂停":"播放"},i(r.value?"⏸":"▶"),9,ke),t("button",{class:"btn control-btn",onClick:G,title:"前进一帧"},"⏩"),t("div",we,[t("label",Se,[e[12]||(e[12]=m("速度: ")),E(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),class:"select"},e[11]||(e[11]=[oe('<option value="0.25" data-v-b0659ffc>0.25x</option><option value="0.5" data-v-b0659ffc>0.5x</option><option value="1" data-v-b0659ffc>1x</option><option value="2" data-v-b0659ffc>2x</option><option value="4" data-v-b0659ffc>4x</option>',5)]),512),[[I,y.value]])]),t("label",xe,[e[14]||(e[14]=m("降频: ")),E(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"select"},e[13]||(e[13]=[t("option",{value:"1"},"无",-1),t("option",{value:"2"},"1/2",-1),t("option",{value:"4"},"1/4",-1),t("option",{value:"8"},"1/8",-1)]),512),[[I,k.value]])])])]),t("div",Ce,[t("button",{class:M(["btn record",{recording:c.value}]),onClick:A},i(c.value?"停止录制":"开始录制"),3),t("button",{class:"btn screenshot",onClick:J}," 截取画面 "),c.value?(u(),d("div",De,[t("span",Ee,i(O.value),1),t("span",Ve,i(T.value),1)])):V("",!0)]),t("div",Le,[t("div",{class:"log-header"},[e[15]||(e[15]=t("h3",null,"测试数据日志",-1)),t("button",{class:"btn btn-small",onClick:W},"导出日志")]),t("div",Te,[(u(!0),d($,null,U(S.value,(s,n)=>(u(),d("div",{key:n,class:"log-item"},[t("span",Pe,i(s.time),1),t("span",{class:M(["log-type",s.type])},i(s.type),3),t("span",Re,i(s.message),1)]))),128))])])])])]))}}),Me=se($e,[["__scopeId","data-v-b0659ffc"]]);export{Me as default};
