import{d as M,r as i,e as U,f as T,g as B,c as u,a as t,w as _,h as F,v as S,i as x,j as z,F as E,b as V,t as r,o as p,_ as D}from"./index-DTcpmoGO.js";import{r as m,B as $}from"./ReportService-Bb8YbWiv.js";const H={class:"reports-page"},N={class:"reports-container"},j={class:"reports-header"},I={class:"search-filters"},P={class:"search-bar"},A={class:"filter-group"},O={class:"upload-section"},G={class:"reports-grid"},K={class:"report-icon"},Q={class:"report-info"},W={class:"report-meta"},q={class:"type-badge"},J={class:"status-badge"},X={class:"report-details"},Y={class:"report-actions"},Z=["onClick","disabled"],ee=["onClick"],te=M({__name:"ReportsView",setup(oe){const v=i([]),h=i(!1),l=i(""),c=i(""),f=i(""),g=()=>{console.log("搜索:",l.value)},w=()=>{l.value="",console.log("已清空搜索")},d=async()=>{try{const o=await m.getReports();console.log("获取到的文件列表:",o.data),v.value=o.data.map(e=>({id:e.id,filename:e.filename,name:e.name,type:e.name.toLowerCase().endsWith(".pdf")?"PDF":"HTML",status:"已上传",createTime:new Date(e.uploadTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),size:b(e.size),downloadUrl:`${$}/uploads/${e.filename}`})),console.log("处理后的报告列表:",v.value)}catch(o){console.error("获取报告列表失败:",o)}},y=U(()=>{let o=v.value.filter(e=>l.value.trim()===""?!0:e.name.toLowerCase().includes(l.value.toLowerCase()));return c.value&&(o=o.filter(e=>e.type===c.value)),f.value&&(o=o.filter(e=>e.status===f.value)),o}),b=o=>{if(o===0)return"0 B";const e=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,n)).toFixed(2))+" "+s[n]},R=async o=>{var n;const e=o.target;if(!((n=e.files)!=null&&n.length))return;const s=e.files[0];h.value=!0;try{console.log("准备上传文件:",{name:s.name,size:s.size,type:s.type});const a=await m.uploadReport(s);console.log("上传响应:",a.data),e.value="",await d()}catch(a){console.error("上传失败:",a),alert("上传失败: "+(a instanceof Error?a.message:"未知错误"))}finally{h.value=!1}},k=async o=>{try{console.log("开始下载文件:",o.filename);const e=await fetch(o.downloadUrl);if(!e.ok)throw new Error(`下载失败: ${e.status} ${e.statusText}`);const s=await e.blob(),n=window.URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=o.name,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a),console.log("文件下载完成")}catch(e){console.error("下载文件时出错:",e),alert("下载文件失败，请重试")}},C=async o=>{if(confirm("确定要删除这个报告吗？"))try{if(console.log("准备删除文件:",o),!o.filename)throw new Error("文件名不能为空");await m.deleteReport(o.filename),console.log("文件删除成功"),await d()}catch(e){console.error("删除失败:",e),alert("删除失败: "+(e instanceof Error?e.message:"未知错误"))}},L=()=>{setInterval(()=>{d()},5e3)};return T(()=>{d(),L()}),B(()=>{}),(o,e)=>(p(),u("div",H,[e[4]||(e[4]=t("div",{class:"page-header"},[t("h2",null,"测试报告"),t("p",null,"查看和下载测试报告")],-1)),t("div",N,[t("div",j,[t("div",I,[t("div",P,[_(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),placeholder:"搜索报告...",onInput:g},null,544),[[S,l.value]]),l.value?(p(),u("button",{key:0,class:"clear-search",onClick:w}," ✕ ")):F("",!0)]),t("div",A,[_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s)},e[2]||(e[2]=[t("option",{value:""},"所有类型",-1),t("option",{value:"HTML"},"HTML",-1),t("option",{value:"PDF"},"PDF",-1)]),512),[[x,c.value]])])])]),t("div",O,[t("input",{type:"file",id:"file-upload",class:"file-input",onChange:R,accept:".html,.pdf"},null,32),e[3]||(e[3]=t("label",{for:"file-upload",class:"upload-btn"},[t("i",{class:"upload-icon"},"📤"),z(" 上传报告 ")],-1))]),t("div",G,[(p(!0),u(E,null,V(y.value,s=>(p(),u("div",{key:s.id,class:"report-card"},[t("div",K,r(s.type==="HTML"?"📄":"📑"),1),t("div",Q,[t("h3",null,r(s.name),1),t("div",W,[t("span",q,r(s.type),1),t("span",J,r(s.status),1)]),t("div",X,[t("span",null,r(s.createTime),1),t("span",null,r(s.size),1)])]),t("div",Y,[t("button",{class:"action-btn download",onClick:n=>k(s),disabled:s.status==="生成中"}," 下载 ",8,Z),t("button",{class:"action-btn delete",onClick:n=>C(s)}," 删除 ",8,ee)])]))),128))])])]))}}),ne=D(te,[["__scopeId","data-v-d501e664"]]);export{ne as default};
